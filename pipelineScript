pipeline{
    agent any
    stages{
        stage('Building Artifact'){
        steps{
        withMaven(maven:'MAVEN_HOME')
        {
        sh "mvn clean install package -DskipTests -Dmaven.javadoc.skip=true"

        }
        }
        }
        stage('Code Quality Analysis'){
            
        steps{
        withSonarQubeEnv('SonarServer')
        {
        withMaven(maven:'MAVEN_HOME')
        {
        sh "mvn sonar:sonar"
        }    
        }    
        }
        }

        stage("Quality Gate"){
          timeout(time: 1, unit: 'HOURS') 
      {
        waitForQualityGate abortPipeline: true
        def qg= waitForQualityGate()
        if (qg.status!= 'OK'){
          error "Pipeline aborted due to quality gate failure: ${qg.status}"
        }
      }         
      echo 'Quality Gate Passed' 
    }
    }
}
